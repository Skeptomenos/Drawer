<!-- REVIEW_PLAN.md - Generated by Ralphus Reviewer -->

# Code Review Plan

## Summary

| Metric | Value |
|--------|-------|
| **Review Target** | codebase |
| **Branch** | main |
| **Base** | main |
| **Total Files** | 31 |
| **Reviewed** | 9 |
| **Findings** | 0 (0 critical, 0 high, 1 medium, 7 low, 15 info) |
| **Status** | In Progress |

## Project Context

**Drawer** is a macOS menu bar utility (Swift 5.9+, macOS 14.0+) that hides menu bar icons using the "10k pixel hack". Key areas of concern:

- **TCC Permissions**: Requires Accessibility and Screen Recording permissions
- **Private APIs**: Uses undocumented CGS APIs (App Store risk)
- **Event Simulation**: Posts synthetic mouse events on user's behalf
- **Screen Capture**: Captures menu bar region using ScreenCaptureKit

## Review Items

### Priority 0 - Critical (Security, Permissions, Private APIs)

| Status | File | Focus Areas | Findings |
|--------|------|-------------|----------|
| [x] | `Drawer/Core/Managers/PermissionManager.swift` | TCC permission flow, AXIsProcessTrusted validation, permission polling | 0 (1 info) |
| [x] | `Drawer/Utilities/EventSimulator.swift` | CGEvent injection, coordinate validation, permission gating | 0 (1 info) |
| [x] | `Drawer/Core/Engines/IconCapturer.swift` | Screen recording permission check, SCStreamConfiguration security | 0 (2 low, 1 info) |
| [x] | `Drawer/Utilities/ScreenCapture.swift` | CGWindowListCreateImage usage, permission gating | 0 (2 low, 2 info) |
| [x] | `Drawer/Bridging/Shims/Private.swift` | Private API declarations, @_silgen_name usage, App Store compliance | 0 (1 low, 1 info) |
| [x] | `Drawer/Bridging/Bridging.swift` | CGS API wrappers, cross-process window access | 0 (1 medium, 1 low, 2 info) |
| [x] | `Drawer/Utilities/GlobalEventMonitor.swift` | Global event monitoring, event types, permission requirements | 0 (2 info) |
| [x] | `Drawer/Utilities/WindowInfo.swift` | CGWindowList enumeration, cross-process information access | 0 (1 low, 3 info) |
| [x] | `Drawer/Core/Managers/SettingsManager.swift` | @AppStorage usage, hotkey validation, no sensitive data logging | 0 (2 info) |

### Priority 1 - Core Logic (Business Logic, State Management)

| Status | File | Focus Areas | Findings |
|--------|------|-------------|----------|
| [ ] | `Drawer/Core/Managers/MenuBarManager.swift` | 10k pixel hack correctness, NSStatusItem positioning, memory management | - |
| [ ] | `Drawer/Core/Managers/DrawerManager.swift` | State management, icon refresh logic, Combine subscriptions cleanup | - |
| [ ] | `Drawer/App/AppState.swift` | State coordination, manager lifecycle, click-through routing | - |
| [ ] | `Drawer/Core/Managers/HoverManager.swift` | Mouse tracking, gesture detection, event listener cleanup | - |

### Priority 2 - Integration (Panel Controllers, Window Management)

| Status | File | Focus Areas | Findings |
|--------|------|-------------|----------|
| [ ] | `Drawer/UI/Panels/DrawerPanelController.swift` | Panel lifecycle, animation handling, memory leaks | - |
| [ ] | `Drawer/UI/Panels/DrawerPanel.swift` | NSPanel configuration, window level, behavior flags | - |
| [ ] | `Drawer/UI/Overlay/OverlayPanelController.swift` | Overlay lifecycle, menu bar positioning | - |
| [ ] | `Drawer/UI/Overlay/OverlayPanel.swift` | Overlay window configuration, event handling | - |

### Priority 3 - UI/Presentation (SwiftUI Views, Components)

| Status | File | Focus Areas | Findings |
|--------|------|-------------|----------|
| [ ] | `Drawer/UI/Panels/DrawerContentView.swift` | View performance, state bindings, accessibility | - |
| [ ] | `Drawer/UI/Overlay/OverlayContentView.swift` | Hover states, click handling, accessibility | - |
| [ ] | `Drawer/UI/Settings/SettingsView.swift` | Tab navigation, state management | - |
| [ ] | `Drawer/UI/Settings/GeneralSettingsView.swift` | Settings bindings, validation | - |
| [ ] | `Drawer/UI/Settings/AppearanceSettingsView.swift` | Appearance settings, bindings | - |
| [ ] | `Drawer/UI/Settings/AboutView.swift` | Static content, links | - |
| [ ] | `Drawer/UI/Onboarding/OnboardingView.swift` | Step navigation, state flow | - |
| [ ] | `Drawer/UI/Onboarding/PermissionsStepView.swift` | Permission grant buttons, status display | - |
| [ ] | `Drawer/UI/Onboarding/WelcomeStepView.swift` | Feature highlights, navigation | - |
| [ ] | `Drawer/UI/Onboarding/TutorialStepView.swift` | Tutorial content, UX | - |
| [ ] | `Drawer/UI/Onboarding/CompletionStepView.swift` | Completion flow, quick reference | - |
| [ ] | `Drawer/UI/Components/PermissionStatusView.swift` | Permission display, state binding | - |
| [ ] | `Drawer/Models/DrawerItem.swift` | Data model, Identifiable/Hashable | - |

### Priority 4 - Configuration

| Status | File | Focus Areas | Findings |
|--------|------|-------------|----------|
| [ ] | `hidden/Info.plist` | Bundle config, required permissions declared | - |
| [ ] | `LauncherApplication/Info.plist` | Launcher config, LSUIElement | - |

## Known Concerns

From AGENTS.md and project documentation:

- **MenuBarManager** marked as CRITICAL - 10k pixel hack is fragile and must be handled carefully
- **IconCapturer** marked as HIGH risk - ScreenCaptureKit integration
- **PermissionManager** marked as HIGH risk - TCC permission flows must not be bypassed
- **Private APIs** - CGS APIs are undocumented and may break or cause App Store rejection
- **Event Simulation** - Posting synthetic events requires careful validation

## Approval Criteria

- [ ] No critical severity findings
- [ ] No high severity findings unaddressed
- [ ] All security concerns documented
- [ ] TCC permissions properly gated
- [ ] Private API usage documented with rationale
- [ ] No hardcoded secrets or sensitive data exposure
- [ ] Event listener cleanup verified (no memory leaks)
- [ ] Code follows project conventions (AGENTS.md)

## Review Log

| Date | File | Reviewer | Result |
|------|------|----------|--------|
| 2026-01-17 | `Drawer/Core/Managers/PermissionManager.swift` | Ralphus | PASSED (0 critical, 0 high, 1 info) |
| 2026-01-17 | `Drawer/Utilities/EventSimulator.swift` | Ralphus | PASSED (0 critical, 0 high, 1 info) |
| 2026-01-17 | `Drawer/Core/Engines/IconCapturer.swift` | Ralphus | PASSED (0 critical, 0 high, 2 low, 1 info) |
| 2026-01-17 | `Drawer/Utilities/ScreenCapture.swift` | Ralphus | PASSED (0 critical, 0 high, 2 low, 2 info) |
| 2026-01-17 | `Drawer/Bridging/Shims/Private.swift` | Ralphus | PASSED (0 critical, 0 high, 1 low, 1 info) |
| 2026-01-17 | `Drawer/Bridging/Bridging.swift` | Ralphus | PASSED (0 critical, 0 high, 1 medium, 1 low, 2 info) |
| 2026-01-17 | `Drawer/Utilities/GlobalEventMonitor.swift` | Ralphus | PASSED (0 critical, 0 high, 0 medium, 0 low, 2 info) |
| 2026-01-17 | `Drawer/Utilities/WindowInfo.swift` | Ralphus | PASSED (0 critical, 0 high, 0 medium, 1 low, 3 info) |
| 2026-01-17 | `Drawer/Core/Managers/SettingsManager.swift` | Ralphus | PASSED (0 critical, 0 high, 0 medium, 0 low, 2 info) |
